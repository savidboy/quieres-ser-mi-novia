<!DOCTYPE html>
<html lang="es-CO">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#fff9f7" />
  <meta name="description" content="Una carta especial para Sheyla con mucho amor" />
  <title>Querida Sheyla ü§ç</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü§ç</text></svg>">

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:ital,wght@0,400;0,700;1,700;1,900&family=Quicksand:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #fff9f7;
      --card: #ffffff;
      --accent: #ff6b81;
      --muted: #7a5a5a;
      --ink: #382f2f;
      --radius: 18px;
      --maxwidth: 1150px;
      --paper: #fffaf6;
      --shadow-1: 0 24px 80px rgba(56,43,43,0.08);
      --shadow-2: 0 8px 28px rgba(56,43,43,0.04);
      --shadow-3: 0 8px 20px rgba(0,0,0,0.04);
      --focus: 2px solid rgba(255,107,129,0.35);
    }

    * { 
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      scroll-behavior: smooth;
    }

    body {
      margin: 0;
      background: linear-gradient(180deg, var(--paper) 0%, #fff7f4 60%);
      font-family: 'Quicksand', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: var(--ink);
      padding: 22px 18px 42px;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      line-height: 1.6;
    }

    .wrap {
      width: 100%;
      max-width: var(--maxwidth);
      background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.995));
      border-radius: 22px;
      box-shadow: var(--shadow-1);
      padding: 28px;
      position: relative;
      overflow: visible;
    }

    .wrap::before, .wrap::after {
      content: "";
      position: absolute;
      width: 360px;
      height: 360px;
      border-radius: 50%;
      opacity: 0.06;
      pointer-events: none;
      transform-origin: center;
      animation: slow-spin 20s linear infinite;
      z-index: 0;
    }

    .wrap::before { 
      right: -140px; 
      top: -120px; 
      background: radial-gradient(circle at 30% 30%, #ffdfe6, transparent 40%); 
      transform: rotate(12deg); 
    }

    .wrap::after { 
      left: -140px; 
      bottom: -120px; 
      background: radial-gradient(circle at 70% 70%, #fff1f3, transparent 40%); 
      transform: rotate(-6deg); 
    }

    @keyframes slow-spin { 
      from { transform: rotate(0); } 
      to { transform: rotate(360deg); } 
    }

    /* Respeto a usuarios con reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .wrap::before, .wrap::after { animation: none; }
      .card:hover { transform: none; }
      .avatar:hover { transform: none; }
      .message, #secretModal, #secretOverlay { transition: none; }
      html { scroll-behavior: auto; }
    }

    /* Header Styles */
    header {
      text-align: center;
      margin-bottom: 12px;
      position: relative;
      z-index: 1;
    }

    .lead { 
      font-size: 15px; 
      color: var(--muted); 
      margin-bottom: 6px; 
      font-style: italic; 
      opacity: 0.98; 
    }

    h1 { 
      font-family: 'Great Vibes', cursive; 
      font-size: clamp(42px, 8vw, 60px);
      margin: 6px 0 0 0; 
      color: #6a333a; 
      line-height: 1; 
      text-shadow: 0 2px 6px rgba(106,51,58,0.04); 
    }

    .meta { 
      color: var(--muted); 
      font-size: 13px; 
      margin-top: 6px; 
    }

    /* Main Content Layout */
    main { 
      margin-top: 18px; 
      display: grid; 
      grid-template-columns: 1fr 380px; 
      gap: 22px; 
      padding-right: 8px; 
      align-items: start; 
      position: relative;
      z-index: 1;
    }

    .content { 
      min-width: 0; 
      max-height: 80vh; 
      overflow: auto; 
      padding-right: 12px; 
      scroll-behavior: smooth; 
    }

    /* Card Styles */
    .card { 
      background: var(--card); 
      border-radius: 16px; 
      padding: 20px; 
      box-shadow: 0 6px 28px rgba(56,43,43,0.05); 
      margin-bottom: 16px; 
      line-height: 1.6; 
      position: relative; 
      transition: transform .18s ease, box-shadow .18s ease; 
    }

    .card:hover { 
      transform: translateY(-4px); 
      box-shadow: 0 10px 35px rgba(56,43,43,0.08);
    }

    h2 { 
      font-family: 'Playfair Display', serif; 
      font-size: clamp(18px, 4vw, 20px);
      margin: 0 0 8px 0; 
      color: #5b3336; 
    }

    p { 
      margin: 10px 0; 
      color: var(--ink); 
      font-size: 15px; 
      white-space: pre-wrap; 
    }

    .quote { 
      border-left: 4px solid var(--accent); 
      padding-left: 12px; 
      margin: 12px 0; 
      font-style: italic; 
      color: #5a4042; 
      background: linear-gradient(90deg, rgba(255,107,129,0.03), rgba(255,200,210,0.02)); 
      border-radius: 8px; 
      padding: 12px; 
    }

    ul { 
      margin: 8px 0 8px 20px; 
    } 

    li { 
      margin: 6px 0; 
    }

    /* Sidebar */
    aside { 
      min-width: 0; 
      position: sticky; 
      top: 26px; 
      align-self: start; 
      max-height: 80vh; 
      overflow: auto; 
    }

    .card.side { 
      display: flex; 
      flex-direction: column; 
      gap: 12px; 
      align-items: center; 
      text-align: center; 
      padding: 18px; 
    }

    .avatar { 
      width: 120px; 
      height: 120px; 
      border-radius: 999px; 
      background: linear-gradient(180deg,#fff,#fff0); 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-size: 48px; 
      box-shadow: 0 10px 30px rgba(106,51,58,0.06); 
      transform: translateY(0); 
      transition: transform .28s cubic-bezier(.2,.9,.3,1); 
    }

    .avatar:hover { 
      transform: translateY(-6px) rotate(-4deg); 
    }

    .tiny { 
      color: var(--muted); 
      font-size: 13px; 
      line-height: 1.4; 
    }

    .hearts { 
      display: flex; 
      gap: 10px; 
      margin-top: 8px; 
    } 

    .heart { 
      width: 46px; 
      height: 46px; 
      border-radius: 12px; 
      display: inline-grid; 
      place-items: center; 
      border: 1px solid rgba(106,51,58,0.06); 
      font-size: 20px; 
      color: var(--accent); 
      background: linear-gradient(180deg,#fff,#fff6);
      transition: transform .2s ease;
    }

    .heart:hover {
      transform: scale(1.1);
    }

    footer { 
      margin-top: 18px; 
      text-align: center; 
      color: var(--muted); 
      font-size: 13px; 
      position: relative;
      z-index: 1;
    }

    .signature { 
      margin-top: 8px; 
      font-weight: 700; 
      color: #4a2b2d; 
      font-size: 15px; 
    }

    /* Responsive Design */
    @media (max-width: 980px) {
      main { 
        grid-template-columns: 1fr; 
        padding-right: 0;
      }
      
      .content {
        padding-right: 0;
        max-height: none;
      }
      
      aside {
        position: static;
        max-height: none;
      }
      
      .avatar { 
        width: 96px; 
        height: 96px; 
        font-size: 40px; 
      }
    }

    @media (max-width: 768px) {
      body {
        padding: 12px 10px 24px;
      }
      
      .wrap {
        padding: 20px 16px;
        border-radius: 18px;
      }
      
      .wrap::before, .wrap::after {
        width: 200px;
        height: 200px;
      }
      
      .wrap::before {
        right: -80px;
        top: -60px;
      }
      
      .wrap::after {
        left: -80px;
        bottom: -60px;
      }
    }

    /* Juego - Estilos Mejorados */
    .canvas-container { 
      padding: 14px; 
      border-radius: 16px; 
      background: linear-gradient(180deg,#fff,#fff8f8); 
      box-shadow: var(--shadow-2); 
    }

    canvas#gameCanvas {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 8px;
      background: linear-gradient(180deg,#fff6f8,#fff0f2);
      box-shadow: var(--shadow-3);
      border: 1px solid rgba(106,51,58,0.03);
      outline: none;
      max-width: 100%;
    }

    .controls { 
      display: flex; 
      gap: 8px; 
      justify-content: center; 
      margin-top: 8px; 
      flex-wrap: wrap;
    }

    .btn { 
      padding: 8px 12px; 
      border-radius: 999px; 
      border: 1px solid rgba(56,43,43,0.06); 
      background: white; 
      cursor: pointer; 
      font-weight: 700; 
      color: #5b3336; 
      transition: transform .12s ease, background .12s ease, box-shadow .12s ease; 
      font-family: inherit;
    }

    .btn:hover { 
      background: #fff3f5; 
      transform: translateY(-2px); 
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .btn:focus { 
      outline: var(--focus);
    }

    .btn:active {
      transform: translateY(0);
    }

    .small { 
      font-size: 13px; 
      color: var(--muted); 
    }

    .title {
      font-weight: 800;
      color: #5b3336;
      margin-bottom: 6px;
      text-align: center;
    }

    .ui {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    .badge {
      display: inline-flex;
      gap: 6px;
      align-items: center;
      padding: 6px 10px;
      border: 1px solid rgba(0,0,0,0.06);
      border-radius: 999px;
      background: #fff;
      font-weight: 700;
      color: #5b3336;
      font-size: 14px;
    }

    .status {
      margin-top: 6px;
      text-align: center;
      font-weight: 700;
      color: #5b3336;
      min-height: 20px;
      font-size: 14px;
    }

    /* Mensajes flash mejorados */
    .message {
      position: fixed;
      left: 50%;
      top: 18px;
      transform: translateX(-50%);
      background: #fff;
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 10px;
      box-shadow: 0 10px 28px rgba(0,0,0,0.14);
      padding: 10px 14px;
      font-weight: 800;
      color: #6a333a;
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s ease, transform .2s ease;
      z-index: 1001;
      max-width: 90%;
      text-align: center;
    }

    .message.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(-50%) translateY(0);
    }

    /* Modal secretos mejorado */
    #secretModal {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%,-50%) scale(0.98);
      min-width: 300px;
      max-width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      padding: 18px;
      background: linear-gradient(180deg,#fff,#fff9f7);
      border-radius: 14px;
      box-shadow: 0 30px 80px rgba(0,0,0,0.25);
      opacity: 0;
      pointer-events: none;
      transition: transform .22s cubic-bezier(.2,.9,.3,1), opacity .22s ease;
      z-index: 1000;
      text-align: center;
    }

    #secretModal.visible { 
      transform: translate(-50%,-50%) scale(1); 
      opacity: 1; 
      pointer-events: auto; 
    }

    #secretModal h3 { 
      margin: 6px 0 10px 0; 
      font-family: 'Great Vibes',cursive; 
      font-size: 28px; 
      color: #6a333a;
    }

    #secretModal p { 
      margin: 8px 0; 
      font-weight: 700; 
      color: #5b3336; 
      white-space: pre-wrap; 
    }

    #secretModal button { 
      margin-top: 10px; 
      padding: 8px 12px; 
      border-radius: 999px; 
      border: 1px solid rgba(56,43,43,0.06); 
      background: white; 
      cursor: pointer; 
      font-weight: 700; 
      font-family: inherit;
    }

    #secretModal button:focus { 
      outline: var(--focus);
    }

    #secretModal button:hover {
      background: #fff3f5;
    }

    #secretOverlay { 
      position: fixed; 
      inset: 0; 
      background: linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.14)); 
      opacity: 0; 
      pointer-events: none; 
      transition: opacity .2s ease; 
      z-index: 999; 
    }

    #secretOverlay.visible { 
      opacity: 1; 
      pointer-events: auto; 
    }

    /* Botones de secreto mejorados */
    .page-secret {
      position: absolute; 
      background: transparent; 
      border: none; 
      font-size: 20px; 
      cursor: pointer;
      transform: translate(-50%,-50%); 
      opacity: 0.95; 
      transition: transform .22s ease, filter .22s ease, opacity .2s;
      z-index: 2;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .page-secret:hover { 
      transform: translate(-50%,-50%) scale(1.18); 
      filter: drop-shadow(0 6px 18px rgba(255,107,129,0.22)); 
    }

    .page-secret:focus { 
      outline: var(--focus); 
      border-radius: 12px; 
    }

    /* Firma mejorada */
    .signature-card {
      border-radius: 14px;
      padding: 14px;
      background: linear-gradient(180deg, rgba(255,245,246,0.75), rgba(255,250,250,0.6));
      border: 1px solid rgba(255,107,129,0.06);
      box-shadow: 0 10px 30px rgba(106,51,58,0.03);
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      margin-top: 12px;
    }

    .sig-left { 
      display: flex; 
      gap: 12px; 
      align-items: center; 
    }

    .sig-avatar { 
      width: 64px; 
      height: 64px; 
      border-radius: 12px; 
      background: linear-gradient(180deg,#fff,#ffecec); 
      display: grid; 
      place-items: center; 
      font-size: 30px; 
      color: #9b3b43; 
      box-shadow: 0 6px 18px rgba(106,51,58,0.04); 
      transform: translateY(0); 
      transition: transform .18s ease; 
    }

    .sig-avatar:hover { 
      transform: translateY(-6px); 
    }

    .sig-text { 
      text-align: left; 
    }

    .sig-title { 
      font-weight: 800; 
      color: #5b3336; 
      font-size: 15px; 
    }

    .sig-sub { 
      font-size: 12px; 
      color: var(--muted); 
    }

    .flair { 
      display: inline-block; 
      padding: 6px 10px; 
      background: linear-gradient(90deg,#fff8, #fff2); 
      border-radius: 999px; 
      border: 1px solid rgba(255,107,129,0.06); 
      font-size: 13px; 
      color: #8a383f; 
      font-weight: 700; 
    }

    /* Indicador de carga para recursos */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,107,129,0.3);
      border-radius: 50%;
      border-top-color: var(--accent);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Navegaci√≥n entre secciones */
    .nav-dots {
      position: fixed;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 100;
    }

    .nav-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255,107,129,0.3);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .nav-dot.active {
      background: var(--accent);
      transform: scale(1.2);
    }

    @media (max-width: 768px) {
      .nav-dots {
        display: none;
      }
    }

    /* Mejoras para el reproductor de audio */
    .player-wrap {
      margin-top: 6px;
      text-align: center;
    }

    .player-title {
      font-weight: 600;
      color: #5b3336;
      margin-bottom: 8px;
    }

    audio {
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
      display: block;
      border-radius: 20px;
    }

    audio:focus {
      outline: var(--focus);
    }

    /* Indicador de teletransporte */
    .teleport-indicator {
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 100px;
      background: linear-gradient(90deg, rgba(255,107,129,0.3), transparent);
      border-radius: 0 10px 10px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ff6b81;
      font-size: 24px;
      z-index: 5;
    }

    /* Estilos para letras sincronizadas */
    .lyric-line {
      transition: all 0.3s ease !important;
    }
    .lyric-line.active:not([style*="italic"]) {
      background: linear-gradient(90deg, rgba(255,107,129,0.1), rgba(255,200,210,0.05)) !important;
      color: #ff6b81 !important;
      font-weight: 700 !important;
      transform: scale(1.02) !important;
      border-left: 3px solid #ff6b81 !important;
    }
    .lyrics-display::-webkit-scrollbar {
      width: 6px;
    }
    .lyrics-display::-webkit-scrollbar-track {
      background: rgba(255,107,129,0.1);
      border-radius: 3px;
    }
    .lyrics-display::-webkit-scrollbar-thumb {
      background: #ff6b81;
      border-radius: 3px;
    }
    
    /* Efecto de destello para nuevos versos */
    @keyframes lyricFlash {
      0% { background: rgba(255,107,129,0.2); }
      100% { background: rgba(255,107,129,0.1); }
    }
    
    .lyric-line.active:not([style*="italic"]) {
      animation: lyricFlash 0.5s ease;
    }
  </style>
</head>

<body>
  <div class="wrap" role="article" aria-label="Carta para Sheyla">
    <header>
      <div class="lead">Pues algo que decir antes de que leas hice esto con mucho cari√±o y espero que te guste mi princesa</div>
      <h1>Querida Sheyla ü§ç</h1>
      <div class="meta">01/16/2025</div>
    </header>

    <main>
      <section class="content" id="content" aria-label="Contenido principal">
        
        <article class="card" id="page-1" aria-labelledby="intro-title">
          <h2 id="intro-title">Introducci√≥n</h2>
          <p>Hice esto para recordarte todo lo que significas para mi.
Espero te guste ü§ç</p>
          <button class="page-secret" data-secret="Eres mi mejor casualidad ü§ç" style="left:88%; top:22%;" aria-label="Secreto rom√°ntico">ü§ç</button>
        </article>

        <article class="card" id="page-2" aria-labelledby="primera-title">
          <h2 id="primera-title">Que paso por mi mente la primera vez que te vi</h2>
          <p>La primera vez que te vi, tan inocente y tan curiosa por las cosas que hablaba sobre mi me pareciste demasiado interesante y me acerque a hablarte, en mi mente solo tenia:</p>
          <div class="quote">"¬øPor qu√© tiene tanta curiosidad?"
"¬øPor qu√© con ella si quiero hablar?"</div>
          <p>Realmente son cosas que al d√≠a de hoy no se explicar, simplemente quise acercarme y hablar contigo y conocerte mas de cerca.</p>
          <button class="page-secret" data-secret="Mi coraz√≥n supo tu nombre desde ese d√≠a ‚ú®" style="left:82%; top:66%;" aria-label="Secreto rom√°ntico">ü§ç</button>
        </article>

        <article class="card" id="page-3" aria-labelledby="equivoco-title">
          <h2 id="equivoco-title">¬øQu√© es lo primero que pens√© cuando te conoc√≠ y en qu√© me equivoqu√©?</h2>
          <p>JSAKJSKAJKSA, me da mucha risa ver lo equivocado que estaba.
Porque para mi que no esperaba estar con nadie quise estar relacionado contigo instant√°neamente aunque fuera "un mejor amigo siquiera" o eso esperaba porque me daba miedo expresar que me gustaste y en tan poco.</p>
          <p>Me daba miedo que al decirte "¬øQuieres ser mi novia?" y me dijeras que no perdi√©ramos la amistad que ten√≠amos en esos momentos pero eso es una historia que ya tu conoces as√≠ que hablemos mas de lo que no sabes.</p>
          <p>Pense que serias como las chicas con las que hablaba siempre y que tan Equivocado estaba eres linda, me escuchas, me respetas, me entiendes Y me encanta tu forma de ser y humor de todas las formas posibles.</p>
          <button class="page-secret" data-secret="Me equivoqu√© de miedo, no de amor." style="left:18%; top:30%;" aria-label="Secreto rom√°ntico">ü§ç</button>
        </article>

        <article class="card" id="page-4" aria-labelledby="valoro-title">
          <h2 id="valoro-title">¬øQu√© es lo que m√°s valoro de nuestra relaci√≥n?</h2>
          <p>Valoro demasiado la conexi√≥n que tenemos y que aunque discutamos. O yo te haga enojar siempre estamos ah√≠ para darnos apoyo.</p>
          <p>Que una pelea no se nos hace un momento de rabia donde nos arrepentimos por cosas que decimos ya que siempre que sucede nos quedamos pensando en que es culpa de nosotros mismos pero nunca de la otra persona puede parecer algo tonto pero esos momentos donde discutimos y dejamos de hablar nos sentimos mal los dos, es una relaci√≥n donde no existe el desinter√©s siempre es un inter√©s abismal por parte de los dos.</p>
          <button class="page-secret" data-secret="Tu calma me salva. Tu risa me encuentra." style="left:14%; top:24%;" aria-label="Secreto rom√°ntico">ü§ç</button>
        </article>

        <article class="card" id="page-5" aria-labelledby="siento-title">
          <h2 id="siento-title">¬øQu√© siento contigo?</h2>
          <p>Siento esas ganas de protegerte constantemente, que no te pase nada malo. No importa si el que debe sufrir soy yo, si alg√∫n d√≠a tienes algo soy capaz de dar mi vida si eso significa que tu te sientas aunque sea un poco mejor.</p>
          <p>Quiero que siempre sepas que suceda lo que suceda siempre tendr√°s mi apoyo y mi amor eres una de las pocas decisiones con las que puedo decir "Pensaste bien esta vez". Esperar por ti y no abandonarte ese d√≠a fue mi mejor elecci√≥n y orgullosamente siempre lo dire.</p>
          <div class="quote">Eres mi mejor elecci√≥n.</div>
          <button class="page-secret" data-secret="Elegirte es mi decisi√≥n favorita." style="left:72%; top:36%;" aria-label="Secreto rom√°ntico">ü§ç</button>
        </article>

        <article class="card" id="page-6" aria-labelledby="futuro-title">
          <h2 id="futuro-title">Nuestro futuro</h2>
          <p>Hablamos constantemente de nuestro futuro pero aqu√≠ quiero dejarte escrito que quiero un futuro contigo y no importa lo que suceda y lo me cueste o tarde QUIERO QUE SEAS TU.</p>
          <p>No importa si debo comenzar desde cero para estar contigo, si debo viajar si debo trabajar 22 horas del d√≠a. Porque se que las 2 horas que me sobran las disfrutare como nunca y el cansancio y el estr√©s ser√°n inexistentes.</p>
          <p>Asi que nunca pienses que no quiero hablar contigo porque hablar contigo me calma, no se si me entiendes simplemente eres mi lugar seguro en cualquier situaci√≥n.</p>
          <button class="page-secret" data-secret="Nuestro futuro sabe a caf√© y domingos juntos ‚òïü§ç" style="left:50%; top:18%;" aria-label="Secreto rom√°ntico">ü§ç</button>
        </article>

        <article class="card" id="page-7" aria-labelledby="promesas-title">
          <h2 id="promesas-title">Prometo que siempre...</h2>
          <ul>
            <li>Prometo que siempre te apoyare y nunca te dejare de amar.</li>
            <li>Prometo cuidarte a costa de mi vida.</li>
            <li>Prometo pensar mas en tu salud que en la mia.</li>
            <li>Prometo serte leal en cualquier momento.</li>
            <li>Y prometo amarte por siempre y si en alg√∫n momento sientes que no es as√≠ Tenme un poco de paciencia que eres la primera ni√±a que me ha gustado desde que tengo raz√≥n.</li>
          </ul>
          <button class="page-secret" data-secret="Prometerte es cuidarte en lo peque√±o." style="left:22%; top:64%;" aria-label="Secreto rom√°ntico">ü§ç</button>
        </article>

        <article class="card" id="page-8" aria-labelledby="gracias-title">
          <h2 id="gracias-title">Gracias por...</h2>
          <p>Gracias por amarme y hacerme feliz todos los d√≠as, Gracias por entenderme y que soy idiota algunas veces y digo cosas que no gustan, gracias por no alejarte al saber que tuve un pasado donde era mierda, gracias por estar conmigo y darme la seguridad aunque sean por celos bobos gracias por rega√±arme cuando vez que estoy haciendo algo malo.</p>
          <p>En resumen gracias por cambiarme y permitirme amarte de esta manera.</p>
          <button class="page-secret" data-secret="Gracias por quedarte incluso cuando yo no sab√≠a c√≥mo." style="left:84%; top:42%;" aria-label="Secreto rom√°ntico">ü§ç</button>
        </article>

        <article class="card" id="page-9" aria-labelledby="cancion-title">
          <h2 id="cancion-title">Nuestra canci√≥n + Jueguito</h2>
          <p>Hay una melod√≠a que, sin decir mucho, siempre me trae a ti. No hablo de versos ni de frases; hablo de esa sensaci√≥n que me da escuchar algo y sentir que te tengo un poquito m√°s cerca.</p>

          <div class="quote" style="text-align:center;">
            <a href="https://music.youtube.com/watch?v=sUZOuXo2Bp8&si=jnc7BJ2nh2Sy32l2" target="_blank" rel="noopener" style="text-decoration:none; color:#ff6b81; font-weight:bold;">
              ‚ñ∂ Escuchar (la canci√≥n que siempre me recuerda a ti) ü§ç
            </a>
          </div>

          <div class="player-wrap" aria-label="Reproductor de nuestra canci√≥n">
            <div class="player-title">Nuestra canci√≥n (presiona Play)</div>
            <audio id="loveSong" controls preload="metadata">
              <source src="asi-te-pedi-zeri.mp3" type="audio/mpeg">
              Tu navegador no soporta audio.
            </audio>
            <div class="tiny" style="text-align:center; margin-top:6px;">(Aseg√∫rate que 'asi-te-pedi-zeri.mp3' est√© en la misma carpeta)</div>
          </div>

          <div style="width:100%; margin-top:18px;">
            <div class="canvas-container" aria-label="√Årea de juego y controles">
              <div class="title">Shey Level Devil ‚Äî 14 niveles TROLL ü§ç</div>
              <div class="teleport-indicator" id="teleportIndicator">‚áÑ</div>
              <canvas id="gameCanvas" width="900" height="480" tabindex="0" aria-label="Mini juego para Sheyla"></canvas>

              <div class="ui" aria-live="polite">
                <div class="badge">Nivel: <span id="levelLabel">1</span></div>
                <div class="badge">Intentos: <span id="triesLabel">0</span></div>
                <div class="badge">Power-up: <span id="powerLabel">‚ùå Sin doble salto</span></div>
              </div>

              <div class="controls" style="margin-top:8px">
                <button id="restartBtn" class="btn" type="button">Reiniciar</button>
                <button id="nextBtn" class="btn" type="button" aria-describedby="status">Siguiente nivel</button>
              </div>

              <div id="status" class="status" role="status" aria-live="polite">Nivel 1 ‚Äî Cuidado d√≥nde pisas... ü§ç</div>
            </div>
          </div>

          <button class="page-secret" data-secret="Dale Play y qu√©date conmigo un ratito." style="left:10%; top:20%;" aria-label="Secreto rom√°ntico">ü§ç</button>
        </article>

        <!-- SECCI√ìN BOY WITH LUV CON SINCRONIZACI√ìN EXACTA DEL LRC CORRECTO -->
        <article class="card" id="page-10" aria-labelledby="bwl-title">
          <h2 id="bwl-title">Nuestra Canci√≥n: Boy With Luv üéµ</h2>
          <p>Esta canci√≥n me recuerda a nosotros - c√≥mo el amor simple y genuino puede ser tan poderoso.</p>

          <div class="player-wrap" style="margin: 20px 0;">
            <div class="player-title">Boy With Luv - BTS (feat. Halsey)</div>
            <audio id="bwlAudio" controls preload="metadata">
              <source src="boy-with-luv.mp3" type="audio/mpeg">
              Tu navegador no soporta el elemento audio.
            </audio>
            <div class="tiny" style="text-align:center; margin-top:6px;">
              (Aseg√∫rate de tener el archivo "boy-with-luv.mp3" en la misma carpeta)
            </div>
          </div>

          <div class="lyrics-container" style="margin-top: 20px;">
            <div class="lyrics-title" style="text-align: center; font-weight: 700; color: #5b3336; margin-bottom: 15px;">
              Letra Sincronizada ü§ç
              <div id="currentSection" style="font-size: 12px; font-weight: 400; color: #ff6b81; margin-top: 5px;">
                Presiona play para comenzar...
              </div>
            </div>
            
            <div id="lyricsDisplay" class="lyrics-display" style="
              height: 300px;
              overflow-y: auto;
              padding: 15px;
              background: linear-gradient(180deg, #fffaf8, #fff5f5);
              border-radius: 12px;
              border: 1px solid rgba(255,107,129,0.1);
              font-size: 14px;
              line-height: 1.8;
              text-align: center;
            ">
              <!-- La letra se cargar√° din√°micamente -->
            </div>
            
            <div class="lyrics-controls" style="
              display: flex;
              gap: 10px;
              justify-content: center;
              margin-top: 12px;
              flex-wrap: wrap;
            ">
              <button id="resetLyricsBtn" class="btn" style="font-size: 13px;">
                üîÑ Reiniciar Letra
              </button>
              <button id="adjustSyncBtn" class="btn" style="font-size: 13px;">
                ‚öôÔ∏è Ajustar Sincronizaci√≥n
              </button>
            </div>
          </div>

          <div style="margin-top: 20px; text-align: center;">
            <p class="tiny">"You got me high so fast" - como t√∫ conmigo, mi amor</p>
          </div>

          <button class="page-secret" data-secret="Cada 'Oh my my my' es por ti." style="left:85%; top:15%;" aria-label="Secreto musical">üéµ</button>
        </article>

        <article class="card" id="page-11" aria-labelledby="final-title">
          <h2 id="final-title">Y esto seria todo princesa ü§ç</h2>
          <p>espero que te all√° gustado este peque√±o regalo de mi parte, TE AMO demasiado mi ni√±a.
Eres mi todo.</p>

          <div class="signature-card" style="margin-top:12px">
            <div class="sig-left">
              <div class="sig-avatar" aria-hidden="true">S</div>
              <div class="sig-text">
                <div class="sig-title">Con todo mi coraz√≥n ‚Äî Samuel ü§ç</div>
                <div class="sig-sub">01/16/2025 ¬∑ Guardado para ti</div>
              </div>
            </div>
            <div style="text-align:right">
              <div class="flair">Hecho con paciencia y amor</div>
            </div>
          </div>

          <button class="page-secret" data-secret="Hoy y siempre, contigo. ü§ç" style="left:92%; top:18%;" aria-label="Secreto rom√°ntico">ü§ç</button>
        </article>

      </section>

      <aside aria-label="Resumen y nota">
        <div class="card side" aria-labelledby="sidebar-title">
          <div id="sidebar-title" style="font-weight:800;color:#5b3336">Un resumen bonito</div>
          <div class="avatar" aria-hidden="true">ü§ç</div>
          <div class="tiny">Guardado con cuidado desde 01/16/2025 ‚Äî un texto hecho para ti, con risas, promesas y muchas ganas de verte.</div>
          <div class="hearts" aria-hidden="true">
            <div class="heart">‚ô•</div><div class="heart">‚ù£</div><div class="heart">üí´</div>
          </div>

          <div class="signature-card" style="margin-top:10px; width:100%;">
            <div class="sig-left">
              <div class="sig-avatar" aria-hidden="true">S</div>
              <div class="sig-text">
                <div class="sig-title">Con todo mi coraz√≥n, Samuel ü§ç</div>
                <div class="sig-sub">01/16/2025 ¬∑ Guardado para ti</div>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top:10px; padding:12px; box-shadow:none; border:none;">
            <div class="tiny">Si quieres, personalizo frases de cada secreto con recuerdos puntuales (lugar, canci√≥n, frase).</div>
          </div>
        </div>

        <div class="card side" aria-labelledby="nota-title">
          <div id="nota-title" style="font-weight:700;color:#5b3336">Nota r√°pida</div>
          <p class="tiny">Esto fue escrito y guardado con empe√±o para ti. Si te emociona, h√°zmelo saber; si quieres que lo ajuste, lo har√©.</p>
        </div>
      </aside>
    </main>

    <footer>
      <div style="font-size:13px;color:#7a5a5a">Hecho con cari√±o ¬∑ C√≥pialo, impr√≠melo o gu√°rdalo como quieras.</div>
    </footer>
  </div>

  <!-- Navegaci√≥n por puntos -->
  <div class="nav-dots" id="navDots" aria-label="Navegaci√≥n entre secciones"></div>

  <!-- Modal para secretos -->
  <div id="secretOverlay" aria-hidden="true"></div>
  <div id="secretModal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="secretTitle">
    <h3 id="secretTitle">Secreto</h3>
    <p id="secretText">my princess ü§ç i love u</p>
    <button id="closeSecretBtn" type="button" aria-label="Cerrar di√°logo">Cerrar</button>
  </div>

  <script>
    // Inicializaci√≥n cuando el DOM est√© listo
    document.addEventListener('DOMContentLoaded', function() {
      // ========== MEJORAS DE RENDIMIENTO Y ACCESIBILIDAD ==========
      
      // Precarga de recursos cr√≠ticos
      function preloadCriticalResources() {
        const criticalImages = [];
        criticalImages.forEach(src => {
          const img = new Image();
          img.src = src;
        });
      }
      
      // Navegaci√≥n por puntos entre secciones
      function initSectionNavigation() {
        const sections = document.querySelectorAll('.card');
        const navDots = document.getElementById('navDots');
        
        if (!navDots) return;
        
        // Crear puntos de navegaci√≥n
        sections.forEach((section, index) => {
          const dot = document.createElement('div');
          dot.className = 'nav-dot';
          dot.setAttribute('aria-label', `Ir a secci√≥n ${index + 1}`);
          dot.addEventListener('click', () => {
            section.scrollIntoView({ behavior: 'smooth', block: 'start' });
          });
          navDots.appendChild(dot);
        });
        
        // Actualizar punto activo al hacer scroll
        function updateActiveDot() {
          const scrollPos = window.scrollY + 100;
          
          sections.forEach((section, index) => {
            const dot = navDots.children[index];
            const sectionTop = section.offsetTop;
            const sectionBottom = sectionTop + section.offsetHeight;
            
            if (scrollPos >= sectionTop && scrollPos < sectionBottom) {
              dot.classList.add('active');
            } else {
              dot.classList.remove('active');
            }
          });
        }
        
        window.addEventListener('scroll', updateActiveDot);
        updateActiveDot(); // Inicializar
      }
      
      // ========== SISTEMA DE AUDIO MEJORADO ==========
      let audioCtx = null;
      let isAudioEnabled = false;
      
      function ensureAudio() {
        if (!audioCtx) {
          try { 
            audioCtx = new (window.AudioContext || window.webkitAudioContext)(); 
            console.log("AudioContext creado correctamente");
          } catch(e) { 
            console.warn('AudioContext no soportado:', e);
            audioCtx = null; 
          }
        }
      }
      
      function resumeAudioIfNeeded() {
        if (audioCtx && audioCtx.state === 'suspended') {
          audioCtx.resume().then(() => {
            isAudioEnabled = true;
            console.log("AudioContext reanudado");
          }).catch((e) => {
            console.warn("Error reanudando AudioContext:", e);
          });
        } else if (audioCtx) {
          isAudioEnabled = true;
        }
      }
      
      // Desbloquear audio con la primera interacci√≥n
      const unlockAudio = () => { 
        ensureAudio(); 
        resumeAudioIfNeeded(); 
        document.removeEventListener('click', unlockAudio);
        document.removeEventListener('keydown', unlockAudio);
      };
      
      document.addEventListener('click', unlockAudio, { once: true });
      document.addEventListener('keydown', unlockAudio, { once: true });
      
      // Funci√≥n mejorada de sonidos
      function playTone(freq, type='sine', duration=0.12, gain=0.12, when=0, detune=0) {
        if (!audioCtx) { 
          ensureAudio(); 
          if(!audioCtx) return; 
        }
        
        // Asegurarnos de que el audio est√© habilitado
        if (!isAudioEnabled) {
          resumeAudioIfNeeded();
        }
        
        try {
          const t = audioCtx.currentTime + when;
          const o = audioCtx.createOscillator();
          const g = audioCtx.createGain();
          o.type = type; 
          o.frequency.setValueAtTime(freq, t); 
          o.detune.value = detune;
          g.gain.setValueAtTime(0.0001, t);
          g.gain.exponentialRampToValueAtTime(gain, t + 0.01);
          g.gain.exponentialRampToValueAtTime(0.0001, t + duration);
          o.connect(g); 
          g.connect(audioCtx.destination);
          o.start(t); 
          o.stop(t + duration + 0.02);
        } catch(e) {
          console.warn('Error reproduciendo sonido:', e);
        }
      }
      
      const sfx = {
        jump(){ playTone(420,'sine',0.08,0.12); },
        double(){ playTone(520,'triangle',0.12,0.14); playTone(660,'sine',0.09,0.08,0.05); },
        power(){ playTone(880,'sine',0.18,0.15); playTone(1320,'triangle',0.12,0.08,0.06); },
        hit(){ playTone(180,'sawtooth',0.14,0.18); },
        ok(){ playTone(620,'sine',0.12,0.14); playTone(780,'sine',0.12,0.12,0.06); playTone(980,'triangle',0.18,0.08,0.12); },
        modal(){ playTone(720,'sine',0.14,0.16); playTone(940,'sine',0.12,0.08,0.06); },
        secret(){ playTone(1020,'triangle',0.12,0.14); },
        teleport(){ playTone(660,'sine',0.2,0.18); playTone(880,'triangle',0.15,0.12,0.05); }
      };
      
      // ========== SISTEMA DE SECRETOS MEJORADO ==========
      const secretModal = document.getElementById('secretModal');
      const secretOverlay = document.getElementById('secretOverlay');
      const secretTextEl = document.getElementById('secretText');
      const closeSecretBtn = document.getElementById('closeSecretBtn');
      const pageSecrets = Array.from(document.querySelectorAll('.page-secret'));
      
      function showSecret(text){
        if (!secretModal || !secretTextEl) return;
        
        secretTextEl.textContent = text;
        secretModal.classList.add('visible');
        secretOverlay.classList.add('visible');
        sfx.modal();
        
        // Trampa de foco accesible:
        closeSecretBtn.focus();
        document.addEventListener('keydown', escClose);
        
        // Prevenir scroll del body
        document.body.style.overflow = 'hidden';
      }
      
      function hideSecret(){
        secretModal.classList.remove('visible');
        secretOverlay.classList.remove('visible');
        document.removeEventListener('keydown', escClose);
        
        // Restaurar scroll del body
        document.body.style.overflow = '';
      }
      
      function escClose(e){ 
        if(e.key === 'Escape') hideSecret(); 
      }
      
      // Inicializar botones de secretos
      pageSecrets.forEach(btn => {
        btn.addEventListener('click', () => {
          const t = btn.dataset.secret || 'my princess ü§ç i love u';
          sfx.secret();
          showSecret(t);
        });
        
        btn.addEventListener('keydown', (e) => {
          if(e.key === 'Enter' || e.key === ' '){ 
            e.preventDefault(); 
            btn.click(); 
          }
        });
      });
      
      closeSecretBtn.addEventListener('click', hideSecret);
      secretOverlay.addEventListener('click', hideSecret);
      
      // ========== SISTEMA DE LETRA SINCRONIZADA - BOY WITH LUV CON LRC EXACTO ==========
      function initBTSLyrics() {
        const audioElement = document.getElementById('bwlAudio');
        const lyricsDisplay = document.getElementById('lyricsDisplay');
        const resetBtn = document.getElementById('resetLyricsBtn');
        const adjustSyncBtn = document.getElementById('adjustSyncBtn');
        const currentSectionEl = document.getElementById('currentSection');
        
        if (!audioElement || !lyricsDisplay) return;

        // LRC EXACTO en ingl√©s - Parseado correctamente
        const lrcText = `[ar:BTS]
[al:MAP OF THE SOUL: 7]
[ti:Boy With Luv (feat. Halsey)]
[length:03:50.46]
[re:www.megalobiz.com/lrc/maker]
[ve:v1.2.3]
[00:00.44](Oh-oh-oh-oh-oh)
[00:03.88](Oh-oh-oh-oh-oh)
[00:07.88](Oh-oh-oh-oh-oh)
[00:11.86](Oh-oh-oh-oh-oh)
[Verse 1: Jimin]
[00:16.11]I'm curious about you, how's your day?
[00:19.58]Oh, tell me (Oh yeah oh yeah, ah yeah ah yeah)
[00:23.83]What makes you happy?
[00:27.54]Oh, text me (Oh yeah oh yeah, oh yeah oh yeah)
[Verse 2: V, Jin]
[00:32.33]Your every picture
[00:34.46]I wanna have under my pillow, oh, oh bae
[00:40.31]Come be my teacher
[00:42.18]Teach me everything about you
[00:45.54]Your one, your two
[Pre-Chorus: Jungkook, Jimin]
[00:47.66]Listen my my baby
[00:49.52]I'm flying high up in the sky
[00:53.53](With the two wings that you gave me back then)
[00:55.91]Now it's so high up here
[00:57.77]I want you tuned in to my eyes
[01:01.75]Yeah, you makin' me a boy with luv
[Chorus: Halsey, Jungkook, Jimin]
[01:04.41]Oh my, my, my, (uh) oh my, my, my
[01:07.60]I've waited all my life
[01:09.45]I want to be with you through everything
[01:12.64]Oh my, my, my, (yeah) oh my, my, my
[01:15.30]Looking for something right
[01:17.42]Okay, now, I kinda get it
[Post-Chorus: Halsey]
[01:20.09](oh-oh-oh-oh-oh)
[01:21.94]I want something stronger (I want it)
[01:24.06](oh-oh-oh-oh-oh)
[01:25.66]Than a moment, than a moment, love
[01:28.05](oh-oh-oh-oh-oh)
[01:29.91]I have waited longer
[01:31.76](oh-oh-oh-oh-oh)
[01:33.36]For a boy with, for a boy with luv
[Verse 3: Suga]
[01:36.29]From the moment I met you, ya, my life was all you, ya
[01:40.01]You're the star that turns ordinaries into extraordinaries, oh yeah
[01:44.25]One after another ay, ay, everything is special ay, ay
[01:48.25]The things you're interested in, the way you walk or talk, and every little trivial habit of yours
[Verse 4: J-Hope, Jungkook]
[01:51.95](Hope world, ay)
[01:52.75]Everyone says that I used to be so little and now I became a hero (Oh no)
[01:56.47]I say that something like destiny was never my thing (Oh no)
[02:00.19]World peace (No way)
[02:02.05]A great order (No way)
[02:04.18]I just want to keep you safe
[02:06.57](Boy with luv)
[Pre-Chorus: V, RM, Jin]
[02:07.72]Listen my my baby
[02:09.58]I'm flying high up in the sky
[02:12.77](With the two wings that you gave me back then)
[02:15.68]Now, it's so high up here
[02:17.81]I want you tuned in to my eyes
[02:21.28]Yeah, you makin' me a boy with luv
[Chorus: Halsey, Jungkook, Jimin]
[02:24.47]Oh my, my, my, (uh) oh my, my, my
[02:27.40]You got me high so fast
[02:29.25]I want to be with you through everything
[02:32.43]Oh my, my, my, oh my, my, my
[02:35.35]You got me fly so fast
[02:37.48]Okay, now, I kinda' get it
[Post-Chorus: V, Jin, Halsey]
[02:39.88](Oh-oh-oh-oh-oh)
[02:41.73]Love is nothing stronger (I want it)
[02:43.86](Oh-oh-oh-oh-oh)
[02:45.46](Than a boy with) Than a boy with luv
[02:47.86](Oh-oh-oh-oh-oh)
[02:49.73]Love is nothing stronger
[02:51.57](Oh-oh-oh-oh-oh)
[02:53.70](Than a boy with) Than a boy with luv
[Bridge: RM, Halsey]
[02:56.10]I'll tell you frankly
[02:57.42]Sometimes I was a little stuck up
[03:00.09]Elevated sky, expanded halls
[03:01.96]Sometimes I prayed, let me run away
[03:04.08]But your pain is my pain
[03:05.93]When I realised that, I vowed to myself (Yeah)
[03:08.06]With the wings of Icarus you gave me (Uh)
[03:09.65]Not towards the sun but towards you
[03:11.53]Let me fly
[Chorus: Jungkook, V, Halsey]
[03:12.85]Oh my, my, my, (uh) oh my, my, my
[03:15.24]I've waited all my life (All my life)
[03:17.38]I want to be with you through everything
[03:20.29]Oh my, my, my, (yeah) oh my, my, my (Oh, oh)
[03:23.48]Looking for something right (Right)
[03:25.62]Okay, now, I kinda' get it
[Post-Chorus: Jungkook, Jimin, Halsey]
[03:27.75](Oh-oh-oh-oh-oh)
[03:29.87]I want something stronger (I want something stronger, I want it)
[03:32.26](Oh-oh-oh-oh-oh)
[03:33.86]Than a moment, than a moment, love (Mo-moment, love)
[03:35.65](Oh-oh-oh-oh-oh)
[03:37.84]Love is nothing stronger (ooh ooh, oh yeah)
[03:39.63](Oh-oh-oh-oh-oh)
[03:41.75](Than a boy with) Than a boy with luv`;

        // Parsear el LRC exactamente
        function parseLRC(lrcText) {
          const lines = lrcText.split('\n');
          const lyrics = [];
          let currentSection = "Intro";
          
          for (const line of lines) {
            // Buscar etiquetas de secci√≥n [Verse 1: Jimin]
            const sectionMatch = line.match(/\[([^:\]]+)(?::[^\]]+)?\]/);
            if (sectionMatch && !line.match(/\[\d+:\d+\.\d+\]/)) {
              currentSection = sectionMatch[1];
              continue;
            }
            
            // Buscar tiempos [mm:ss.xx]
            const timeMatch = line.match(/\[(\d+):(\d+)\.(\d+)\](.*)/);
            if (timeMatch) {
              const minutes = parseFloat(timeMatch[1]);
              const seconds = parseFloat(timeMatch[2]);
              const milliseconds = parseFloat(timeMatch[3]) / 100;
              const text = timeMatch[4].trim();
              
              // Convertir a segundos totales
              const totalSeconds = minutes * 60 + seconds + milliseconds;
              
              if (text && !text.includes('BTS') && !text.includes('MAP OF THE SOUL') && 
                  !text.includes('Boy With Luv') && !text.includes('www.megalobiz.com')) {
                lyrics.push({
                  time: totalSeconds,
                  text: text,
                  section: currentSection
                });
              }
            }
          }
          
          return lyrics;
        }

        const lyrics = parseLRC(lrcText);
        let currentLyricIndex = -1;
        let isSyncing = false;
        let lastSection = "";
        let syncOffset = 0; // Ajuste de sincronizaci√≥n en segundos

        // Funci√≥n para renderizar la letra
        function renderLyrics() {
          lyricsDisplay.innerHTML = lyrics.map((line, index) => 
            `<div class="lyric-line" data-index="${index}" data-section="${line.section}"
                  style="margin: 8px 0; padding: 5px 10px; border-radius: 8px; transition: all 0.3s ease;">
              ${line.text}
            </div>`
          ).join('');
        }

        // Funci√≥n para sincronizar la letra con el audio
        function syncLyrics() {
          if (!audioElement || !isSyncing) return;
          
          const currentTime = audioElement.currentTime + syncOffset;
          let newIndex = -1;
          
          // Encontrar el verso actual basado en el tiempo exacto
          for (let i = lyrics.length - 1; i >= 0; i--) {
            if (currentTime >= lyrics[i].time) {
              newIndex = i;
              break;
            }
          }
          
          // Actualizar solo si cambi√≥ el verso
          if (newIndex !== currentLyricIndex) {
            currentLyricIndex = newIndex;
            updateLyricsDisplay();
            
            // Actualizar secci√≥n actual
            if (currentLyricIndex >= 0) {
              const currentSection = lyrics[currentLyricIndex].section;
              if (currentSection !== lastSection) {
                lastSection = currentSection;
                if (currentSectionEl) {
                  currentSectionEl.textContent = currentSection;
                }
              }
              
              // Scroll autom√°tico al verso actual
              scrollToCurrentLyric();
            }
          }
        }

        // Actualizar la visualizaci√≥n de la letra
        function updateLyricsDisplay() {
          const lines = lyricsDisplay.querySelectorAll('.lyric-line');
          lines.forEach((line, index) => {
            if (index === currentLyricIndex) {
              line.classList.add('active');
              line.style.cssText = `
                background: linear-gradient(90deg, rgba(255,107,129,0.12), rgba(255,200,210,0.06));
                color: #ff6b81;
                font-weight: 700;
                transform: scale(1.02);
                border-left: 3px solid #ff6b81;
                margin: 10px 0;
                padding: 8px 12px;
                border-radius: 8px;
                transition: all 0.3s ease;
              `;
            } else {
              line.classList.remove('active');
              line.style.cssText = `
                color: ${Math.abs(index - currentLyricIndex) <= 2 ? '#7a5a5a' : '#b8a6a9'};
                opacity: ${Math.abs(index - currentLyricIndex) <= 2 ? 1 : 0.6};
                transform: scale(1);
                margin: 8px 0;
                padding: 5px 10px;
                border-radius: 8px;
                transition: all 0.3s ease;
              `;
            }
          });
        }

        // Hacer scroll al verso actual
        function scrollToCurrentLyric() {
          const activeLine = lyricsDisplay.querySelector('.lyric-line.active');
          if (activeLine) {
            activeLine.scrollIntoView({ 
              behavior: 'smooth', 
              block: 'center' 
            });
          }
        }

        // Ajustar sincronizaci√≥n
        function adjustSync() {
          const adjustment = prompt(
            'Ajuste de sincronizaci√≥n (en segundos):\n' +
            'N√∫mero positivo = letra m√°s tarde\n' +
            'N√∫mero negativo = letra m√°s temprano\n' +
            'Actual: ' + syncOffset.toFixed(2) + 's',
            syncOffset.toFixed(2)
          );
          
          if (adjustment !== null) {
            syncOffset = parseFloat(adjustment) || 0;
            currentLyricIndex = -1; // Forzar actualizaci√≥n
            if (currentSectionEl) {
              currentSectionEl.textContent = `Ajuste: ${syncOffset > 0 ? '+' : ''}${syncOffset.toFixed(2)}s`;
            }
          }
        }

        // Iniciar sincronizaci√≥n cuando se reproduce el audio
        function startSync() {
          isSyncing = true;
          if (currentSectionEl) {
            currentSectionEl.textContent = "Sincronizaci√≥n activada üéµ";
          }
        }

        // Detener sincronizaci√≥n cuando se pausa el audio
        function stopSync() {
          isSyncing = false;
          if (currentSectionEl && !audioElement.ended) {
            currentSectionEl.textContent = "Pausado ‚è∏Ô∏è";
          }
        }

        // Event listeners
        resetBtn.addEventListener('click', function() {
          currentLyricIndex = -1;
          lastSection = "";
          syncOffset = 0;
          updateLyricsDisplay();
          lyricsDisplay.scrollTo({ top: 0, behavior: 'smooth' });
          if (currentSectionEl) {
            currentSectionEl.textContent = "Letra reiniciada üîÑ";
          }
        });

        adjustSyncBtn.addEventListener('click', adjustSync);

        // Controlar sincronizaci√≥n autom√°ticamente
        audioElement.addEventListener('play', startSync);
        audioElement.addEventListener('pause', stopSync);
        audioElement.addEventListener('ended', function() {
          isSyncing = false;
          if (currentSectionEl) {
            currentSectionEl.textContent = "Canci√≥n terminada ‚ú®";
          }
        });
        audioElement.addEventListener('timeupdate', syncLyrics);

        // Tambi√©n iniciar sincronizaci√≥n si el audio ya est√° reproduci√©ndose
        if (!audioElement.paused) {
          startSync();
        }

        // Inicializar
        renderLyrics();
      }

      // Llamar a la funci√≥n de inicializaci√≥n
      setTimeout(initBTSLyrics, 1000);

      // ========== JUEGO COMPLETO CON 14 NIVELES TROLL ==========
      // ... (el resto del c√≥digo del juego permanece igual)
      (function(){
        const canvas = document.getElementById('gameCanvas');
        if(!canvas) return;
        
        const ctx = canvas.getContext('2d', { alpha: true });
        const baseW = canvas.width, baseH = canvas.height;
        
        // Elementos de UI
        const levelLabel = document.getElementById('levelLabel');
        const triesLabel = document.getElementById('triesLabel');
        const powerLabel = document.getElementById('powerLabel');
        const statusEl = document.getElementById('status');
        
        // Mensajes flash
        const flashEl = document.createElement('div');
        flashEl.id = 'msg';
        flashEl.className = 'message';
        document.body.appendChild(flashEl);
        let flashTimeout = null;
        
        function flashMessage(text, time=1800){
          flashEl.textContent = text;
          flashEl.classList.add('show');
          clearTimeout(flashTimeout);
          flashTimeout = setTimeout(() => flashEl.classList.remove('show'), time);
        }
        
        // Mensajes de victoria - uno para cada nivel
        const mensajes = [
          "Eres mi mejor casualidad ü§ç",
          "Mi coraz√≥n supo tu nombre desde ese d√≠a ‚ú®",
          "Me equivoqu√© de miedo, no de amor.",
          "Tu calma me salva. Tu risa me encuentra.",
          "Elegirte es mi decisi√≥n favorita.",
          "Nuestro futuro sabe a caf√© y domingos juntos ‚òïü§ç",
          "Prometerte es cuidarte en lo peque√±o.",
          "Gracias por quedarte incluso cuando yo no sab√≠a c√≥mo.",
          "Dale Play y qu√©date conmigo un ratito.",
          "Mi lugar favorito siempre ser√° a tu lado.",
          "Lo que no te digo en voz alta, tambi√©n te lo guardo.",
          "Hoy y siempre, contigo. ü§ç",
          "Tu nombre le queda perfecto a mis planes.",
          "Te elijo en el amanecer y tambi√©n en el cansancio."
        ];
        
        // Sistema de entrada mejorado
        const keys = {left:false, right:false, jump:false};
        
        function handleKeyDown(e) {
          const k = e.key;
          if(['ArrowLeft','ArrowRight','ArrowUp',' '].includes(k)) e.preventDefault();
          if(k==='ArrowLeft') keys.left=true;
          if(k==='ArrowRight') keys.right=true;
          if(k==='ArrowUp' || k===' ') keys.jump=true;
        }
        
        function handleKeyUp(e) {
          const k = e.key;
          if(k==='ArrowLeft') keys.left=false;
          if(k==='ArrowRight') keys.right=false;
          if(k==='ArrowUp' || k===' ') keys.jump=false;
        }
        
        // Controles t√°ctiles para m√≥viles
        function initTouchControls() {
          if ('ontouchstart' in window) {
            const leftBtn = document.createElement('button');
            const rightBtn = document.createElement('button');
            const jumpBtn = document.createElement('button');
            
            leftBtn.textContent = '‚Üê';
            rightBtn.textContent = '‚Üí';
            jumpBtn.textContent = '‚Üë';
            
            [leftBtn, rightBtn, jumpBtn].forEach(btn => {
              btn.style.cssText = `
                position: fixed;
                bottom: 20px;
                width: 60px;
                height: 60px;
                border-radius: 50%;
                background: rgba(255,255,255,0.8);
                border: 2px solid rgba(255,107,129,0.3);
                font-size: 24px;
                z-index: 100;
                touch-action: manipulation;
              `;
              document.body.appendChild(btn);
            });
            
            leftBtn.style.left = '20px';
            rightBtn.style.left = '100px';
            jumpBtn.style.right = '20px';
            
            // Eventos t√°ctiles
            leftBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys.left = true; });
            leftBtn.addEventListener('touchend', (e) => { e.preventDefault(); keys.left = false; });
            
            rightBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys.right = true; });
            rightBtn.addEventListener('touchend', (e) => { e.preventDefault(); keys.right = false; });
            
            jumpBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys.jump = true; });
            jumpBtn.addEventListener('touchend', (e) => { e.preventDefault(); keys.jump = false; });
          }
        }
        
        canvas.addEventListener('keydown', handleKeyDown);
        canvas.addEventListener('keyup', handleKeyUp);
        canvas.addEventListener('click', () => { canvas.focus(); });
        
        // Player con f√≠sica mejorada
        const W = baseW, H = baseH;
        const playerBase = {
          x:48, y:H-120, w:32, h:40,
          vx:0, vy:0,
          onGround:false,
          hasDouble:false, hasJumpedOnce:false,
          alive:true,
          coyoteTime:0,
          jumpBuffer:0
        };
        
        const COYOTE_MAX = 0.12;
        const JUMP_BUFFER_MAX = 0.12;
        const GRAV = 0.58;
        const JUMP_V = -13.0;
        const DOUBLE_V = -13.0;
        const MAX_VX = 4.0;
        const ACCEL = 0.9;
        const FRICTION_GROUND = 0.85;
        const FRICTION_AIR = 0.93;
        
        let player = {...playerBase};
        let currentLevel = 0;
        let tries = 0;
        let levelTries = {};
        
        // Sistema de part√≠culas mejorado
        let particles = [];
        const PARTICLE_GRAV = 0.1;
        
        function emitParticles(x, y, count, color) {
          for (let i = 0; i < count; i++) {
            particles.push({
              x: x, y: y,
              vx: (Math.random() - 0.5) * 6,
              vy: (Math.random() - 0.5) * 6 - 3,
              life: Math.random() * 30 + 30,
              color: color
            });
          }
        }
        
        function emitAsh(x, y) { 
          emitParticles(x + player.w / 2, y + player.h / 2, 20, '#aaaaaa'); 
        }
        
        function updateParticles() {
          for (let i = particles.length - 1; i >= 0; i--) {
            const p = particles[i];
            p.vy += PARTICLE_GRAV;
            p.x += p.vx;
            p.y += p.vy;
            p.life--;
            if (p.life <= 0) particles.splice(i, 1);
          }
        }
        
        function drawParticles() {
          for (const p of particles) {
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.life / 60;
            ctx.fillRect(p.x - 2, p.y - 2, 4, 4);
            ctx.globalAlpha = 1.0;
          }
        }
        
        // Funciones de dibujo optimizadas
        function rr(x,y,w,h,r=6,fill='#fff',stroke='#e6d4d6'){
          ctx.beginPath(); 
          ctx.moveTo(x+r,y);
          ctx.arcTo(x+w,y,x+w,y+h,r);
          ctx.arcTo(x+w,y+h,x,y+h,r);
          ctx.arcTo(x,y+h,x,y,r);
          ctx.arcTo(x,y,x+w,y,r);
          ctx.closePath(); 
          ctx.fillStyle=fill; 
          ctx.fill(); 
          ctx.strokeStyle=stroke; 
          ctx.stroke();
        }
        
        function drawSpike(x,y,w=20,h=16){
          ctx.beginPath(); 
          ctx.moveTo(x,y); 
          ctx.lineTo(x+w/2,y-h); 
          ctx.lineTo(x+w,y); 
          ctx.closePath();
          ctx.fillStyle = '#c33'; 
          ctx.fill();
        }
        
        function drawHeart(x,y,r=12){
          ctx.save(); 
          ctx.translate(x,y); 
          ctx.fillStyle='#ff6b81';
          ctx.beginPath();
          ctx.moveTo(0, r/2);
          ctx.bezierCurveTo(r, -r/2, r*1.4, r/1.6, 0, r*1.4);
          ctx.bezierCurveTo(-r*1.4, r/1.6, -r, -r/2, 0, r/2);
          ctx.fill(); 
          ctx.restore();
        }
        
        function drawStar(x,y,r=10){
          ctx.save(); 
          ctx.translate(x,y); 
          ctx.fillStyle='#ffd86b';
          ctx.beginPath();
          for(let i=0;i<5;i++){
            const a = i*2*Math.PI/5 - Math.PI/2;
            ctx.lineTo(Math.cos(a)*r, Math.sin(a)*r);
            const a2 = a + Math.PI/5;
            ctx.lineTo(Math.cos(a2)*r*0.5, Math.sin(a2)*r*0.5);
          }
          ctx.closePath(); 
          ctx.fill(); 
          ctx.restore();
        }
        
        // Niveles del juego - 14 NIVELES TROLL
        const L = H;
        function baseFloor(){ return [{x:0,y:L-20,w:W,h:20}]; }
        
        const levels = [
          // Nivel 1 - Plataforma falsa con pinchos
          { type:'platform', bg:'warm',
            platforms: baseFloor().concat([
              {x:200,y:L-120,w:140,h:16, fake:true},
              {x:400,y:L-140,w:120,h:16}
            ]),
            spikes: [{x:200,y:L-20,w:140, isFloor:true}],
            goal: {x:440,y:L-180},
            msg: 'Nivel 1 ‚Äî Cuidado d√≥nde pisas... ü§ç',
            powerup: null
          },
          
          // Nivel 2 - Estrella troll
          { type:'platform', bg:'warm',
            platforms: baseFloor().concat([
              {x:320,y:L-100,w:140,h:16},
              {x:520,y:L-160,w:40,h:16, invisible:true}
            ]),
            spikes: [
              {x:380,y:L-100,w:20,h:16, isStarTroll:true}
            ],
            goal: {x:820,y:L-40},
            msg: 'Nivel 2 ‚Äî No conf√≠es en todo lo que brilla.',
            powerup: null
          },
          
          // Nivel 3 - Power-up de doble salto
          { type:'platform', bg:'soft',
            platforms: baseFloor().concat([
              {x:220,y:L-120,w:120,h:16},
              {x:450,y:L-220,w:120,h:16},
              {x:680,y:L-220,w:120,h:16, fake:true}
            ]),
            spikes: [{x:430,y:L-20,w:100, isFloor:true}],
            goal: {x:510,y:L-260},
            powerup: {x:250,y:L-150, active:true},
            msg: 'Nivel 3 ‚Äî T√≥malo. Lo vas a necesitar (creo).'
          },
          
          // Nivel 4 - Controles invertidos
          { type:'platform', bg:'soft',
            platforms: baseFloor().concat([
              {x:200,y:L-140,w:120,h:16},
              {x:400,y:L-140,w:120,h:16}
            ]),
            spikes: [{x:150,y:L-20,w:420, isFloor:true}],
            goal: {x:440,y:L-180},
            msg: 'Nivel 4 ‚Äî ¬øSoy yo, o todo est√° al rev√©s? JSKJS.',
            powerup: null,
            reversed: true
          },
          
          // Nivel 5 - Meta falsa
          { type:'platform', bg:'warm',
            platforms: baseFloor(),
            moving: [{x:600,y:L-160,w:120,h:16,axis:'y',from:L-220,to:L-120,spd:0.8}],
            spikes: [{x:320,y:L-20,w:80, isFloor:true}],
            goal: {x:800,y:L-40, distraction:true},
            msg: 'Nivel 5 ‚Äî No todo lo que brilla es la meta.',
            powerup: null,
            exitWin: true
          },
          
          // Nivel 6 - Plataformas invisibles
          { type:'platform', bg:'soft',
            platforms: baseFloor().concat([
              {x:200,y:L-140,w:120,h:16},
              {x:380,y:L-180,w:40,h:16, invisible:true},
              {x:550,y:L-240,w:120,h:16, invisible:true},
            ]),
            spikes: [{x:200,y:L-20,w:W-200, isFloor:true}],
            goal: {x:750,y:L-40},
            msg: 'Nivel 6 ‚Äî Salta al vac√≠o... conf√≠a en m√≠ ü§ç'
          },
          
          // Nivel 7 - Teletransporte a la derecha
          { type:'platform', bg:'warm',
            platforms: baseFloor().concat([
              {x:520,y:L-220,w:120,h:16}
            ]),
            spikes: [{x:120,y:L-20,w:380, isFloor:true}],
            goal: {x:560,y:L-260},
            msg: 'Nivel 7 ‚Äî Toca la pared izquierda para teletransportarte.',
            powerup: null,
            teleport: true
          },
          
          // Nivel 8 - Meta oculta
          { type:'platform', bg:'soft',
            platforms: baseFloor().concat([{x:260,y:L-240,w:110,h:16}]),
            spikes: [
              {x:420,y:L-20,w:60, isFloor:true},
              {x:500,y:L-20,w:60, isFloor:true},
              {x:380,y:L-240,w:20,h:16, isStarTroll:true}
            ],
            goal: {x:300,y:L-280, hidden:true},
            msg: 'Nivel 8 ‚Äî A veces hay que caerse para ver el camino.',
            powerup: null
          },
          
          // Nivel 9 - Necesitas doble salto
          { type:'platform', bg:'warm',
            platforms: baseFloor().concat([
              {x:450,y:L-220,w:40,h:16, invisible:true},
              {x:620,y:L-280,w:120,h:16}
            ]),
            spikes: [
              {x:220,y:L-20,w:40, isFloor:true},
              {x:280,y:L-20,w:40, isFloor:true},
              {x:340,y:L-20,w:40, isFloor:true},
              {x:620,y:L-20,w:120, isFloor:true}
            ],
            goal: {x:660,y:L-320},
            msg: 'Nivel 9 ‚Äî (Necesitar√°s un doble salto de fe...)',
            powerup: null
          },
          
          // Nivel 10 - Interruptor trampa
          { type:'puzzle-switch', bg:'soft',
            platforms: baseFloor().concat([
              {x:140,y:L-200,w:120,h:16, fake:true},
              {x:380,y:L-240,w:120,h:16}
            ]),
            switches: [{x:160,y:L-216,w:20,h:20,active:false}],
            doors: [{x:520,y:L-20,w:60,h:180,closed:true}],
            spikes: [{x:140,y:L-20,w:120, isFloor:true}],
            goal: {x:660,y:L-40},
            msg: 'Nivel 10 ‚Äî R√°pido, que el piso es mentira.',
            powerup: null
          },
          
          // Nivel 11 - Plataformas m√≥viles
          { type:'platform', bg:'sunset',
            platforms: baseFloor(),
            moving: [
              {x:220,y:L-200,w:100,h:16,axis:'x',from:160,to:300,spd:1.0},
              {x:480,y:L-260,w:100,h:16,axis:'y',from:L-300,to:L-200,spd:0.9}
            ],
            spikes: [
              {x:160,y:L-20,w:140, isFloor:true},
              {x:620,y:L-20,w:60, isFloor:true}
            ],
            goal: {x:500,y:L-300},
            msg: 'Nivel 11 ‚Äî Calma y precisi√≥n... y no te caigas.',
            powerup: null
          },
          
          // Nivel 12 - Secuencia tramposa
          { type:'puzzle-seq', bg:'soft',
            platforms: baseFloor().concat([
               {x:480,y:L-80,w:60,h:14, fake:true}
            ]),
            pads: [
              {x:160,y:L-80,w:60,h:14,color:'#6fb3ff',order:0},
              {x:320,y:L-80,w:60,h:14,color:'#b88bff',order:1},
              {x:480,y:L-80,w:60,h:14,color:'#7be7c7',order:2}
            ],
            seq: [0,1,2],
            spikes: [{x:260,y:L-20,w:100, isFloor:true}, {x:480,y:L-20,w:60, isFloor:true}],
            goal: {x:640,y:L-140},
            msg: 'Nivel 12 ‚Äî 1, 2, 3... ¬°Uy! (Salto r√°pido al final).',
            powerup: null
          },
          
          // Nivel 13 - Salto imposible
          { type:'platform', bg:'warm',
            platforms: baseFloor().concat([
              {x:250,y:L-140,w:120,h:16},
              {x:450,y:L-180,w:40,h:16, invisible:true},
              {x:700,y:L-220,w:120,h:16}
            ]),
            spikes: [{x:150,y:L-20,w:W-150, isFloor:true}],
            goal: {x:760,y:L-260},
            msg: 'Nivel 13 ‚Äî Usa el triple salto (ups, no hay).',
            powerup: null
          },
          
          // Nivel 14 - Meta final troll
          { type:'platform', bg:'sunset',
            platforms: baseFloor().concat([
              {x:300,y:L-260,w:120,h:16},
              {x:500,y:L-200,w:120,h:16, fake:true}
            ]),
            spikes: [{x:420,y:L-20,w:80, isFloor:true}, {x:500,y:L-20,w:120, isFloor:true}],
            goal: {x:340,y:L-300, distraction:true},
            exitWin: true,
            msg: 'Nivel 14 ‚Äî No busques la estrella, ve hasta el final. ü§ç',
            powerup: null
          }
        ];
        
        let puzzle = {switches:[],doors:[],pads:[],seq:[],seqIndex:0};
        
        function setStatus(text){ 
          if (statusEl) statusEl.textContent = text; 
        }
        
        function loadLevel(i){
          const lv = levels[i];
          currentLevel = i;
          
          if (!levelTries[i]) levelTries[i] = 0;
          
          // Piedad para el Nivel 8 (Meta Oculta)
          if (i === 7) {
            const plat = lv.platforms.find(p => p.x === 260);
            const goal = lv.goal;
            if (levelTries[i] >= 3 && plat && goal) {
              plat.y = L - 220;
              goal.y = L - 260;
              lv.msg = 'Nivel 8 ‚Äî (Te baj√© la plataforma un poquito ü§ç)';
            } else {
              if (plat) plat.y = L - 240;
              if (goal) goal.y = L - 280;
              lv.msg = lv.goal.hidden
                ? 'Nivel 8 ‚Äî A veces hay que caerse para ver el camino.'
                : 'Nivel 8 ‚Äî (¬°Necesitas el doble salto!)';
            }
          }
          
          levelLabel.textContent = i+1;
          setStatus(lv.msg || `Nivel ${i+1}`);
          powerLabel.textContent = player.hasDouble ? '‚úÖ Doble salto' : '‚ùå Sin doble salto';
          
          puzzle = {switches:[],doors:[],pads:[],seq:lv.seq||[],seqIndex:0};
          if(lv.switches) puzzle.switches = lv.switches.map(s=>({...s}));
          if(lv.doors) puzzle.doors = lv.doors.map(d=>({...d}));
          if(lv.pads) puzzle.pads = lv.pads.map(p=>({...p,activated:false}));
          
          // Conservar el doble salto si ya se obtuvo
          const hadDoubleJump = player.hasDouble;
          resetPlayer(hadDoubleJump);
          
          // Pero si el nivel es el 3 (√≠ndice 2), resetea el powerup para que se pueda coger
          if (i === 2) {
              resetPlayer(false);
              powerLabel.textContent = '‚ùå Sin doble salto';
              if (lv.powerup) lv.powerup.active = true;
          }
        }
        
        function resetPlayer(withPower=false){
          player = {...playerBase};
          player.x = 48; 
          player.y = H-120;
          player.hasDouble = withPower;
          player.hasJumpedOnce = false;
          player.alive = true;
          player.coyoteTime = 0;
          player.jumpBuffer = 0;
        }
        
        function drawBG(lv){
          if(lv.bg==='sunset'){
            const g = ctx.createLinearGradient(0,0,0,H);
            g.addColorStop(0,'#ffd6c9'); 
            g.addColorStop(1,'#fff8f6');
            ctx.fillStyle = g; 
            ctx.fillRect(0,0,W,H);
          } else if (lv.bg==='soft'){
            const g = ctx.createLinearGradient(0,0,0,H);
            g.addColorStop(0,'#f8fbff'); 
            g.addColorStop(1,'#fef8fb');
            ctx.fillStyle = g; 
            ctx.fillRect(0,0,W,H);
          } else {
            const g = ctx.createLinearGradient(0,0,0,H);
            g.addColorStop(0,'#fffaf6'); 
            g.addColorStop(1,'#fff7f8');
            ctx.fillStyle = g; 
            ctx.fillRect(0,0,W,H);
          }
        }
        
        function handleJump(){
          if(!player.alive) return;
          const canGroundJump = player.onGround || player.coyoteTime > 0;
          if(canGroundJump && player.jumpBuffer > 0){
            player.vy = JUMP_V; 
            player.onGround=false; 
            player.hasJumpedOnce=true; 
            player.jumpBuffer=0; 
            player.coyoteTime=0;
            sfx.jump();
            return;
          }
          if(player.hasDouble && player.hasJumpedOnce && player.jumpBuffer > 0){
            player.vy = DOUBLE_V; 
            player.hasJumpedOnce=false; 
            player.jumpBuffer=0;
            sfx.double();
            setStatus('Doble salto activado üíñ');
          }
        }
        
        function update(){
          const lv = levels[currentLevel];
          
          const isReversed = !!lv.reversed;
          let friction = player.onGround ? FRICTION_GROUND : FRICTION_AIR;
          
          if(isReversed) {
            if(keys.left) player.vx = Math.min(player.vx + ACCEL, MAX_VX);
            else if(keys.right) player.vx = Math.max(player.vx - ACCEL, -MAX_VX);
            else player.vx *= friction;
          } else {
            if(keys.left) player.vx = Math.max(player.vx - ACCEL, -MAX_VX);
            else if(keys.right) player.vx = Math.min(player.vx + ACCEL, MAX_VX);
            else player.vx *= friction;
          }
          
          // jump buffer + coyote timers
          if(keys.jump){ 
            player.jumpBuffer = JUMP_BUFFER_MAX; 
            keys.jump=false; 
          }
          if(player.jumpBuffer > 0) player.jumpBuffer -= 1/60;
          if(player.coyoteTime > 0) player.coyoteTime -= 1/60;
          
          // F√≠sica
          player.vy += GRAV;
          player.x += player.vx;
          player.y += player.vy;
          
          // L√≠mites - Teletransporte en nivel 7
          if(player.x < 0) {
            if (currentLevel === 6) { // Nivel 7 - Teletransporte
              player.x = W - player.w - 20;
              sfx.teleport();
              emitParticles(player.x, player.y, 20, '#ff6b81');
              flashMessage('¬°Teletransportado! ü§ç', 1200);
            } else {
              player.x = 0;
            }
          }
          
          if(player.x + player.w > W) {
            if (lv.exitWin) {
              sfx.ok();
              emitParticles(W - 20, H - 40, 15, '#ff6b81');
              flashMessage(mensajes[currentLevel] || '¬°Lo hiciste! ‚ú®', 2600);
              nextLevel();
              return;
            } else {
              player.x = W - player.w;
            }
          }
          
          // Piso
          if(player.y + player.h > H){
            player.y = H - player.h; 
            player.vy = 0; 
            player.onGround = true; 
            player.hasJumpedOnce=false; 
            player.coyoteTime = COYOTE_MAX;
          } else {
            player.onGround = false;
          }
          
          // Part√≠culas
          updateParticles();
          
          // M√≥viles
          if(lv.moving){
            for(const m of lv.moving){
              const spd = Math.min(m.spd || 0.8, 1.0);
              if(m.axis==='y'){
                m.y = (m.y ?? m.from) + spd * (m.dir || 1);
                if(m.y <= m.from){ m.y = m.from; m.dir = 1; }
                if(m.y >= m.to){ m.y = m.to; m.dir = -1; }
              } else {
                m.x = (m.x ?? m.from) + spd * (m.dir || 1);
                if(m.x <= m.from){ m.x = m.from; m.dir = 1; }
                if(m.x >= m.to){ m.x = m.to; m.dir = -1; }
              }
            }
          }
          
          // Colisi√≥n plataformas
          const plats = (lv.platforms||[]).concat(lv.moving||[]);
          for(const p of plats){
            const isFake = !!p.fake;
            const collX = player.x + player.w > p.x && player.x < p.x + p.w;
            const collY = player.y + player.h > p.y && player.y < p.y + p.h;
            if(collX && collY){
              const fromAbove = player.vy > 0 && (player.y + player.h - player.vy) <= p.y + 6;
              if(fromAbove){
                if(isFake && !p.invisible){
                  p.y += 16; 
                  p.fake = false;
                  player.y = p.y - player.h; 
                  player.vy = 0; 
                  player.onGround = true; 
                  player.hasJumpedOnce=false; 
                  player.coyoteTime = COYOTE_MAX/2;
                  setStatus('Ups, plataforma falsita ‚Äî igual te cuido.');
                } else {
                  player.y = p.y - player.h; 
                  player.vy = 0; 
                  player.onGround = true; 
                  player.hasJumpedOnce=false; 
                  player.coyoteTime = COYOTE_MAX;
                  if (p.invisible) {
                    p.invisible = false;
                    setStatus('¬°Ah√≠ estaba! ü§ç');
                  }
                }
              } else {
                // Colisi√≥n lateral
                if(player.x + player.w/2 < p.x + p.w/2) player.x = p.x - player.w;
                else player.x = p.x + p.w;
                player.vx = 0;
              }
            }
          }
          
          // Power-up doble salto
          if(lv.powerup && lv.powerup.active){
            const px = lv.powerup.x;
            const py = lv.powerup.y;
            const dx = (player.x + player.w/2) - px;
            const dy = (player.y + player.h/2) - py;
            if(Math.hypot(dx,dy) < 18){
              player.hasDouble = true; 
              lv.powerup.active = false; 
              powerLabel.textContent='‚úÖ Doble salto';
              sfx.power();
              emitParticles(px, py, 15, '#ff6b81');
              flashMessage('Coraz√≥n doble salto activado üíñ');
            }
          }
          
          // Spikes
          for(const s of (lv.spikes||[])){
            if(s.isFloor){
              const spikeTop = L-20 - 10;
              const overlapX = player.x + player.w > s.x && player.x < s.x + s.w;
              const overlapY = player.y + player.h > spikeTop;
              if(overlapX && overlapY){
                dieAndReload(true);
                return;
              }
            } else if(s.isStarTroll) {
              const spikeY = s.y - s.h;
              const spikeHitX = (player.x + player.w > s.x + 4 && player.x < s.x + s.w - 4);
              const overlapY = player.y + player.h > spikeY && player.y < s.y;
              if(spikeHitX && overlapY){
                dieAndReload(false, '¬°La estrella troll! ¬°Me mat√≥!');
                return;
              }
            }
          }
          
          // Win condition
          const goal = lv.goal;
          if(goal && !goal.hidden && !goal.distraction && !goal.locked) {
            const gx = goal.x;
            const gy = goal.y;
            const dd = Math.hypot((player.x+player.w/2)-gx, (player.y+player.h/2)-gy);
            if(dd < 20){
              sfx.ok();
              emitParticles(gx, gy, 15, '#ffd86b');
              flashMessage(mensajes[currentLevel] || '¬°Lo hiciste! ‚ú®', 2600);
              nextLevel();
              return;
            }
          }
          
          handleJump();
        }
        
        function draw(){
          const lv = levels[currentLevel];
          ctx.clearRect(0,0,W,H);
          drawBG(lv);
          
          // Piso
          ctx.fillStyle = '#fff'; 
          ctx.fillRect(0,H-60,W,60);
          
          // Plataformas
          const plats = (lv.platforms||[]).concat(lv.moving||[]);
          for(const p of plats){
            let fill = '#fff', stroke = '#e6d4d6';
            if (p.fake) { fill = '#fff8'; stroke = '#ffc0c0'; }
            if (p.invisible) { fill = 'rgba(255, 255, 255, 0.05)'; stroke = 'rgba(230, 212, 214, 0.1)'; }
            rr(p.x,p.y,p.w,p.h,6, fill, stroke);
            if(p.fake && !p.invisible){
              ctx.fillStyle = '#c33';
              ctx.font = 'bold 14px system-ui';
              ctx.textAlign='center';
              ctx.textBaseline='middle';
              ctx.fillText('?', p.x + p.w/2, p.y + p.h/2 + 1);
            }
          }
          
          // Part√≠culas
          drawParticles();
          
          // Spikes
          for(const s of (lv.spikes||[])){
            if(s.isFloor){
              const segments = Math.max(1, Math.floor(s.w/20));
              for(let i=0;i<segments;i++){
                drawSpike(s.x + i*(s.w/segments), L-20, 20, 16);
              }
            } else if(s.isStarTroll) {
              drawStar(s.x + s.w/2, s.y - s.h/2, 12);
            }
          }
          
          // Power-up
          if(lv.powerup && lv.powerup.active){
            drawHeart(lv.powerup.x, lv.powerup.y, 10);
          }
          
          // Meta (si no est√° oculta)
          const goal = lv.goal;
          if(goal && !goal.hidden) {
            drawStar(goal.x, goal.y, 10);
            if (goal.distraction) {
              ctx.strokeStyle = '#c33'; 
              ctx.lineWidth = 3;
              ctx.beginPath();
              ctx.moveTo(goal.x - 10, goal.y - 10); 
              ctx.lineTo(goal.x + 10, goal.y + 10);
              ctx.moveTo(goal.x + 10, goal.y - 10); 
              ctx.lineTo(goal.x - 10, goal.y + 10);
              ctx.stroke(); 
              ctx.lineWidth = 1;
            }
          }
          
          // Indicador de teletransporte en nivel 7
          if (currentLevel === 6) {
            ctx.fillStyle = 'rgba(255,107,129,0.2)';
            ctx.fillRect(0, H/2 - 50, 10, 100);
            ctx.fillStyle = '#ff6b81';
            ctx.font = '12px system-ui';
            ctx.textAlign = 'center';
            ctx.fillText('‚áÑ', 5, H/2);
          }
          
          // Player
          if(player.alive) {
            rr(player.x, player.y, player.w, player.h, 6, '#fff', '#e6d4d6');
            ctx.font = '20px system-ui'; 
            ctx.textAlign='center'; 
            ctx.textBaseline='middle';
            ctx.fillStyle = '#ff6b81'; 
            ctx.fillText('ü§ç', player.x + player.w/2, player.y + player.h/2);
          }
        }
        
        function nextLevel(){
          currentLevel++;
          if(currentLevel >= levels.length){
            const poemaFinal = `Llegaste al final, mi vida. ü§ç

Pasaste el troll, pasaste el miedo.
Como en el juego, como en la vida,
eres la calma que siempre pido.

No hay m√°s niveles, solo nosotros.
Gracias por jugar, y gracias por quedarte.

Eres mi todo, hoy y siempre.
‚Äî Samuel`;
            showSecret(poemaFinal);
            const modalTitle = document.querySelector('#secretModal h3');
            if (modalTitle) modalTitle.textContent = 'Un Poema Para Ti ‚ú®';
            
            setTimeout(()=>{ 
              window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }); 
            }, 500);
            currentLevel = 0;
            levelTries = {};
            tries = 0;
            triesLabel.textContent = tries;
          }
          
          // Carga el siguiente nivel, manteniendo el doble salto si ya lo ten√≠a
          const hadDoubleJump = player.hasDouble;
          loadLevel(currentLevel);
          player.hasDouble = hadDoubleJump;
          if (player.hasDouble) {
              powerLabel.textContent = '‚úÖ Doble salto';
          }
        }
        
        function dieAndReload(inFloor=false, flashText=null) {
          sfx.hit();
          tries++; 
          triesLabel.textContent = tries;
          if (!levelTries[currentLevel]) levelTries[currentLevel] = 0;
          levelTries[currentLevel]++;
          emitAsh(player.x, player.y);
          player.alive = false;
          
          // Nivel 8 ‚Äî Meta oculta aparece al morir
          if(currentLevel === 7 && levels[currentLevel].goal.hidden){
            levels[currentLevel].goal.hidden = false;
            flashMessage('¬°Apareci√≥ la meta! (Ten√≠as que morir ü§ç)', 2000);
          }
          
          if (flashText) flashMessage(flashText, 1400);
          
          setTimeout(() => {
            const hadDoubleJump = player.hasDouble;
            loadLevel(currentLevel);
            player.hasDouble = hadDoubleJump;
            if (player.hasDouble) {
              powerLabel.textContent = '‚úÖ Doble salto';
            }
            setStatus('Te ca√≠ste ‚Äî tranqui, prueba otra vez.');
          }, 300);
        }
        
        // Bucle principal optimizado
        let running = true;
        
        document.addEventListener('visibilitychange', () => {
          running = !document.hidden;
        });
        
        function loop(){
          if(running){
            if(player.alive) update();
            draw();
          }
          requestAnimationFrame(loop);
        }
        
        // Eventos de UI
        document.getElementById('restartBtn').addEventListener('click', () => {
          dieAndReload(false);
          setStatus('Reiniciado ‚Äî respira y dale otra vez.');
        });
        
        document.getElementById('nextBtn').addEventListener('click', () => {
          // Bot√≥n troll
          sfx.hit();
          flashMessage('¬°Ese bot√≥n es trampa! JSKJSKA', 1400);
          dieAndReload(false, '¬°No uses el bot√≥n de saltar nivel! tramposa ü§ç');
        });
        
        // Iniciar juego
        loadLevel(0);
        initTouchControls();
        loop();
      })();
      
      // ========== INICIALIZACI√ìN GENERAL ==========
      preloadCriticalResources();
      initSectionNavigation();
      
      // Scroll inicial suave
      setTimeout(() => { 
        window.scrollTo({ top: 0, behavior: 'smooth' }); 
      }, 100);
      
      // Mejorar rendimiento en dispositivos t√°ctiles
      if ('ontouchstart' in window) {
        document.documentElement.style.touchAction = 'manipulation';
      }
    });
  </script>
</body>
</html>
